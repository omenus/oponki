var ajaxQueries=new Array();var ajaxLoaderOn=0;var sliderList=new Array();var slidersInit=false;$(document).ready(function(){cancelFilter();openCloseFilter();$(document).on("click","#layered_form input[type=button], #layered_form label.layered_color",function(a){a.preventDefault();a.stopPropagation();if(!$("input[name="+$(this).attr("name")+"][type=hidden]").length){$("<input />").attr("type","hidden").attr("name",$(this).attr("name")).val($(this).attr("rel")).appendTo("#layered_form")}else{$("input[name="+$(this).attr("name")+"][type=hidden]").remove()}reloadContent(true);return false});setTimeout(function(){$(document).on("change","#layered_form select, #layered_form input[type=checkbox], #layered_form input[type=radio]",function(a){reloadContent(true,true)})},1000);$(document).on("click","#layered_form button[type=submit]",function(a){a.preventDefault();a.stopPropagation();reloadContent(true,false);return false});$(document).on("keyup","#layered_form input.layered_input_range",function(b){if($(this).attr("timeout_id")){window.clearTimeout($(this).attr("timeout_id"))}var a=this;$(this).attr("timeout_id",window.setTimeout(function(e){if(!$(e).attr("id")){e=a}var d=$(e).attr("id").replace(/^layered_(.+)_range_.*$/,"$1");var c=parseInt($("#layered_"+d+"_range_min").val());if(isNaN(c)){c=0}$("#layered_"+d+"_range_min").val(c);var f=parseInt($("#layered_"+d+"_range_max").val());if(isNaN(f)){f=0}$("#layered_"+d+"_range_max").val(f);if(f<c){$("#layered_"+d+"_range_max").val($(e).val());$("#layered_"+d+"_range_min").val($(e).val())}reloadContent()},500,this))});$(document).on("click","#layered_block_left .radio",function(b){var a=$(this).attr("name");$.each($(this).parent().parent().find("input[type=button]"),function(c,d){if($(d).hasClass("on")&&$(d).attr("name")!=a){$(d).click()}});return true});$("#layered_block_left label a").on({click:function(b){b.preventDefault();var a=$(this).parent().parent().find("input").attr("disabled");if(a==""||typeof(a)=="undefined"||a==false){$(this).parent().parent().find("input").click();reloadContent()}}});layered_hidden_list={};$(".hide-action").on("click",function(a){if(typeof(layered_hidden_list[$(this).parent().find("ul").attr("id")])=="undefined"||layered_hidden_list[$(this).parent().find("ul").attr("id")]==false){layered_hidden_list[$(this).parent().find("ul").attr("id")]=true}else{layered_hidden_list[$(this).parent().find("ul").attr("id")]=false}hideFilterValueAction(this)});$(".hide-action").each(function(){hideFilterValueAction(this)});$(".selectProductSort").unbind("change").bind("change",function(a){$(".selectProductSort").val($(this).val());if($("#layered_form").length>0){reloadContent(true)}});$(document).off("change").on("change","select[name=n]",function(a){$("select[name=n]").val($(this).val());reloadContent(true)});paginationButton(false);initLayered()});function initFilters(){if(typeof filters!=="undefined"){for(key in filters){if(filters.hasOwnProperty(key)){var b=filters[key]}if(typeof b.slider!=="undefined"&&parseInt(b.filter_type)==0){var a=parseInt(b.max)-parseInt(b.min);var c=a/100;if(c>1){c=parseInt(c)}addSlider(b.type,{range:true,step:c,min:parseInt(b.min),max:parseInt(b.max),values:[b.values[0],b.values[1]],slide:function(d,e){stopAjaxQuery();if(parseInt($(d.target).data("format"))<5){from=formatCurrency(e.values[0],parseInt($(d.target).data("format")),$(d.target).data("unit"));to=formatCurrency(e.values[1],parseInt($(d.target).data("format")),$(d.target).data("unit"))}else{from=e.values[0]+$(d.target).data("unit");to=e.values[1]+$(d.target).data("unit")}$("#layered_"+$(d.target).data("type")+"_range").html(from+" - "+to)},stop:function(){reloadContent(true)}},b.unit,parseInt(b.format))}else{if(typeof b.slider!=="undefined"&&parseInt(b.filter_type)==1){$("#layered_"+b.type+"_range_min").attr("limitValue",b.min);$("#layered_"+b.type+"_range_max").attr("limitValue",b.max)}}$(".layered_"+b.type).show()}initUniform()}}function initUniform(){$("#layered_form input[type='checkbox'], #layered_form input[type='radio'], select.form-control").uniform()}function hideFilterValueAction(a){if(typeof(layered_hidden_list[$(a).parent().find("ul").attr("id")])=="undefined"||layered_hidden_list[$(a).parent().find("ul").attr("id")]==false){$(a).parent().find(".hiddable").hide();$(a).parent().find(".hide-action.less").hide();$(a).parent().find(".hide-action.more").show()}else{$(a).parent().find(".hiddable").show();$(a).parent().find(".hide-action.less").show();$(a).parent().find(".hide-action.more").hide()}}function addSlider(a,c,b,d){sliderList.push({type:a,data:c,unit:b,format:d})}function initSliders(){$(sliderList).each(function(a,b){$("#layered_"+b.type+"_slider").slider(b.data);var d="";var c="";switch(b.format){case 1:case 2:case 3:case 4:d=formatCurrency($("#layered_"+b.type+"_slider").slider("values",0),b.format,b.unit);c=formatCurrency($("#layered_"+b.type+"_slider").slider("values",1),b.format,b.unit);break;case 5:d=$("#layered_"+b.type+"_slider").slider("values",0)+b.unit;c=$("#layered_"+b.type+"_slider").slider("values",1)+b.unit;break}$("#layered_"+b.type+"_range").html(d+" - "+c)})}function initLayered(){initFilters();initSliders();initLocationChange();updateProductUrl();if(window.location.href.split("#").length==2&&window.location.href.split("#")[1]!=""){var a=window.location.href.split("#")[1];reloadContent("&selected_filters="+a)}}function paginationButton(f,c){if(typeof(current_friendly_url)==="undefined"){current_friendly_url="#"}$("div.pagination a").not(":hidden").each(function(){if($(this).attr("href").search("&p=")==-1){var h=1}else{var h=$(this).attr("href").replace(/^.*&p=(\d+).*$/,"$1")}var g=window.location.href.replace(/#.*$/,"");$(this).attr("href",g+current_friendly_url.replace(/\/page-(\d+)/,"")+"/page-"+h)});$("div.pagination li").not(".current, .disabled").each(function(){var g=0;if($(this).hasClass("pagination_next")){g=parseInt($("div.pagination li.current").children().children().html())+1}else{if($(this).hasClass("pagination_previous")){g=parseInt($("div.pagination li.current").children().children().html())-1}}$(this).children().children().on("click",function(h){h.preventDefault();if(g==0){p=parseInt($(this).html())+parseInt(g)}else{p=g}p="&p="+p;reloadContent(p);g=0})});if(f!=false){if(isNaN(f)==0){var e=$(".product-count").html();var a=parseInt($("div.pagination li.current").children().children().html());var b=f;if($("#nb_item option:selected").length==0){var d=b}else{var d=parseInt($("#nb_item option:selected").val())}isNaN(a)?a=1:a=a;d*a<b?productShowing=d*a:productShowing=(d*a-b-d*a)*-1;a==1?productShowingStart=1:productShowingStart=d*a-d+1;e=$.trim(e);e=e.split(" ");e[1]=productShowingStart;e[3]=(c!="undefined")&&(c>productShowing)?c:productShowing;e[5]=b;if(e[3]>e[5]){e[3]=e[5]}e=e.join(" ");$(".product-count").html(e);$(".product-count").show()}else{$(".product-count").hide()}}}function cancelFilter(){$(document).on("click","#enabled_filters a",function(a){if($(this).attr("rel").search(/_slider$/)>0){if($("#"+$(this).attr("rel")).length){$("#"+$(this).attr("rel")).slider("values",0,$("#"+$(this).attr("rel")).slider("option","min"));$("#"+$(this).attr("rel")).slider("values",1,$("#"+$(this).attr("rel")).slider("option","max"));$("#"+$(this).attr("rel")).slider("option","slide")(0,{values:[$("#"+$(this).attr("rel")).slider("option","min"),$("#"+$(this).attr("rel")).slider("option","max")]})}else{if($("#"+$(this).attr("rel").replace(/_slider$/,"_range_min")).length){$("#"+$(this).attr("rel").replace(/_slider$/,"_range_min")).val($("#"+$(this).attr("rel").replace(/_slider$/,"_range_min")).attr("limitValue"));$("#"+$(this).attr("rel").replace(/_slider$/,"_range_max")).val($("#"+$(this).attr("rel").replace(/_slider$/,"_range_max")).attr("limitValue"))}}}else{if($("option#"+$(this).attr("rel")).length){$("#"+$(this).attr("rel")).parent().val("")}else{$("#"+$(this).attr("rel")).attr("checked",false);$("."+$(this).attr("rel")).attr("checked",false);$("#layered_form input[type=hidden][name="+$(this).attr("rel")+"]").remove()}}reloadContent(true,true);a.preventDefault()})}function openCloseFilter(){$(document).on("click","#layered_form span.layered_close a",function(a){if($(this).html()=="&lt;"){$("#"+$(this).attr("rel")).show();$(this).html("v");$(this).parent().removeClass("closed")}else{$("#"+$(this).attr("rel")).hide();$(this).html("&lt;");$(this).parent().addClass("closed")}a.preventDefault()})}function stopAjaxQuery(){if(typeof(ajaxQueries)=="undefined"){ajaxQueries=new Array()}for(i=0;i<ajaxQueries.length;i++){ajaxQueries[i].abort()}ajaxQueries=new Array()}function reloadContent(b){var d=false;stopAjaxQuery();if(arguments[1]){d=true}if(!ajaxLoaderOn&&d==false){$(".product_list").prepend($("#layered_ajax_loader").html());$(".product_list").css("opacity","0.7");ajaxLoaderOn=1}if(d){$("#layered_block_left").addClass("loading")}data=$("#layered_form").serialize();$(".layered_slider").each(function(){var f=$(this).slider("values",0);var g=$(this).slider("values",1);if(typeof(f)=="number"&&typeof(g)=="number"){data+="&"+$(this).attr("id")+"="+f+"_"+g}});$(["price","weight"]).each(function(g,f){if($("#layered_"+f+"_range_min").length){data+="&layered_"+f+"_slider="+$("#layered_"+f+"_range_min").val()+"_"+$("#layered_"+f+"_range_max").val()}});$("#layered_form .select option").each(function(){if($(this).attr("id")&&$(this).parent().val()==$(this).val()){data+="&"+$(this).attr("id")+"="+$(this).val()}});if($(".selectProductSort").length&&$(".selectProductSort").val()){if($(".selectProductSort").val().search(/orderby=/)>0){var a=[$(".selectProductSort").val().match(/orderby=(\w*)/)[1],$(".selectProductSort").val().match(/orderway=(\w*)/)[1]]}else{var a=$(".selectProductSort").val().split(":")}data+="&orderby="+a[0]+"&orderway="+a[1]}if($("select[name=n]:first").length){if(b){data+="&n="+$("select[name=n]:first").val()}else{data+="&n="+$("div.pagination form.showall").find("input[name=n]").val()}}var c=false;if(b==undefined){b="";c=false}var e="";if(b){$("div.pagination select[name=n]").children().each(function(g,f){if(f.selected){e="&n="+f.value}})}ajaxQuery=$.ajax({type:"GET",url:baseDir+"modules/blocklayered/blocklayered-ajax.php",data:data+b+e,dataType:"json",cache:false,success:function(f){if(f.meta_description!=""){$('meta[name="description"]').attr("content",f.meta_description)}if(f.meta_keywords!=""){$('meta[name="keywords"]').attr("content",f.meta_keywords)}if(f.meta_title!=""){$("title").html(f.meta_title)}if(f.heading!=""){$("h1.page-heading .cat-name").html(f.heading)}$("#layered_block_left").replaceWith(utf8_decode(f.filtersBlock));$(".category-product-count, .heading-counter").html(f.categoryCount);if(f.nbRenderedProducts==f.nbAskedProducts){$("div.clearfix.selector1").hide()}if(d==false){if(f.productList){$(".product_list").replaceWith(utf8_decode(f.productList))}else{$(".product_list").html("")}$(".product_list").css("opacity","1");if($.browser.msie){$(".product_list").css("filter","")}if(f.pagination.search(/[^\s]/)>=0){var h=$("<div/>").html(f.pagination);var j=$("<div/>").html(f.pagination_bottom);if($("<div/>").html(h).find("#pagination").length){$("#pagination").show();$("#pagination").replaceWith(h.find("#pagination"))}else{$("#pagination").hide()}if($("<div/>").html(j).find("#pagination_bottom").length){$("#pagination_bottom").show();$("#pagination_bottom").replaceWith(j.find("#pagination_bottom"))}else{$("#pagination_bottom").hide()}}else{$("#pagination").hide();$("#pagination_bottom").hide()}paginationButton(f.nbRenderedProducts,f.nbAskedProducts);ajaxLoaderOn=0;$("div.pagination form").on("submit",function(k){k.preventDefault();val=$("div.pagination select[name=n]").val();$("div.pagination select[name=n]").children().each(function(m,l){if(l.value==val){$(l).attr("selected",true)}else{$(l).removeAttr("selected")}});reloadContent()});if(typeof(ajaxCart)!="undefined"){ajaxCart.overrideButtonsInThePage()}if(typeof(reloadProductComparison)=="function"){reloadProductComparison()}}filters=f.filters;initFilters();initSliders();$("#layered_block_left").removeClass("loading");current_friendly_url=f.current_friendly_url;if(typeof(current_friendly_url)==="undefined"){current_friendly_url="#"}$(["price","weight"]).each(function(l,k){if($("#layered_"+k+"_slider").length){if(typeof($("#layered_"+k+"_slider").slider("values",0))!="object"){if($("#layered_"+k+"_slider").slider("values",0)!=$("#layered_"+k+"_slider").slider("option","min")||$("#layered_"+k+"_slider").slider("values",1)!=$("#layered_"+k+"_slider").slider("option","max")){current_friendly_url+="/"+blocklayeredSliderName[k]+"-"+$("#layered_"+k+"_slider").slider("values",0)+"-"+$("#layered_"+k+"_slider").slider("values",1)}}}else{if($("#layered_"+k+"_range_min").length){current_friendly_url+="/"+blocklayeredSliderName[k]+"-"+$("#layered_"+k+"_range_min").val()+"-"+$("#layered_"+k+"_range_max").val()}}});if(current_friendly_url=="#"){current_friendly_url="#/"}window.location.href=current_friendly_url;if(current_friendly_url!="#/show-all"){$("div.clearfix.selector1").show()}lockLocationChecking=true;if(c){$.scrollTo(".product_list",400)}updateProductUrl();$(".hide-action").each(function(){hideFilterValueAction(this)});if(display instanceof Function){var g=$.totalStorage("display");if(g&&g!="grid"){display(g)}}}});ajaxQueries.push(ajaxQuery)}function initLocationChange(b,c){if(!c){c=500}var a=getUrlParams();setInterval(function(){if(getUrlParams()!=a&&!lockLocationChecking){if(a.replace(/^#(\/)?/,"")==getUrlParams().replace(/^#(\/)?/,"")){return}lockLocationChecking=true;reloadContent("&selected_filters="+getUrlParams().replace(/^#/,""))}else{lockLocationChecking=false;a=getUrlParams()}},c)}function getUrlParams(){if(typeof(current_friendly_url)==="undefined"){current_friendly_url="#"}var a=current_friendly_url;if(window.location.href.split("#").length==2&&window.location.href.split("#")[1]!=""){a="#"+window.location.href.split("#")[1]}return a}function updateProductUrl(){if(typeof(param_product_url)!="undefined"&&param_product_url!=""&&param_product_url!="#"){$.each($("ul.product_list li.ajax_block_product .product_img_link,ul.product_list li.ajax_block_product h5 a,ul.product_list li.ajax_block_product .product_desc a,ul.product_list li.ajax_block_product .lnk_view"),function(){$(this).attr("href",$(this).attr("href")+param_product_url)})}}function utf8_decode(f){var d="";for(var b=0;b<f.length;){var g=f.charCodeAt(b);if(g<128){d+=String.fromCharCode(g);b++}else{if((g>191)&&(g<224)){var e=f.charCodeAt(b+1);d+=String.fromCharCode(((g&31)<<6)|(e&63));b+=2}else{var e=f.charCodeAt(b+1);var a=f.charCodeAt(b+2);d+=String.fromCharCode(((g&15)<<12)|((e&63)<<6)|(a&63));b+=3}}}return d};