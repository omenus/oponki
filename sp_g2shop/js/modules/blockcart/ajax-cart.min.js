$(document).ready(function(){ajaxCart.overrideButtonsInThePage();$(document).on("click",".block_cart_collapse",function(f){f.preventDefault();ajaxCart.collapse()});$(document).on("click",".block_cart_expand",function(f){f.preventDefault();ajaxCart.expand()});var d=0;var a=parseInt(new Date().getTime()/1000);if(typeof $(".ajax_cart_quantity").html()=="undefined"||(typeof generated_date!="undefined"&&generated_date!=null&&(parseInt(generated_date)+30)<a)){ajaxCart.refresh()}else{d=parseInt($(".ajax_cart_quantity").html())}var c=new HoverWatcher("#header .cart_block");var b=new HoverWatcher("#header .shopping_cart");if("ontouchstart" in document.documentElement){$(".shopping_cart > a:first").on("click",function(f){f.preventDefault()})}$(document).on("touchstart","#header .shopping_cart a:first",function(){if($(this).next(".cart_block:visible").length){$("#header .cart_block").stop(true,true).slideUp(450)}else{$("#header .cart_block").stop(true,true).slideDown(450)}e.preventDefault();e.stopPropagation()});$("#header .shopping_cart a:first").hover(function(){if(ajaxCart.nb_total_products>0||d>0){$("#header .cart_block").stop(true,true).slideDown(450)}},function(){setTimeout(function(){if(!b.isHoveringOver()&&!c.isHoveringOver()){$("#header .cart_block").stop(true,true).slideUp(450)}},200)});$("#header .cart_block").hover(function(){},function(){setTimeout(function(){if(!b.isHoveringOver()){$("#header .cart_block").stop(true,true).slideUp(450)}},200)});$(document).on("click",".delete_voucher",function(f){f.preventDefault();$.ajax({type:"POST",headers:{"cache-control":"no-cache"},async:true,cache:false,url:$(this).attr("href")+"?rand="+new Date().getTime()});$(this).parent().parent().remove();if($("body").attr("id")=="order"||$("body").attr("id")=="order-opc"){if(typeof(updateAddressSelection)!="undefined"){updateAddressSelection()}else{location.reload()}}});$(document).on("click","#cart_navigation input",function(f){$(this).prop("disabled","disabled").addClass("disabled");$(this).closest("form").get(0).submit()});$(document).on("click","#layer_cart .cross, #layer_cart .continue, .layer_cart_overlay",function(f){f.preventDefault();$(".layer_cart_overlay").hide();$("#layer_cart").fadeOut("fast")});$("#columns #layer_cart, #columns .layer_cart_overlay").detach().prependTo("#columns")});var ajaxCart={nb_total_products:0,overrideButtonsInThePage:function(){$(document).on("click",".ajax_add_to_cart_button",function(b){b.preventDefault();var a=$(this).data("id-product");if($(this).prop("disabled")!="disabled"){ajaxCart.add(a,null,false,this)}});$(document).on("click","#add_to_cart button",function(a){a.preventDefault();ajaxCart.add($("#product_page_product_id").val(),$("#idCombination").val(),true,null,$("#quantity_wanted").val(),null)});$(document).on("click",".cart_block_list .ajax_cart_block_remove_link",function(j){j.preventDefault();var a=0;var f=0;var c=0;var g=$($(this).parent().parent()).find("div[data-id^=deleteCustomizableProduct_]");var b=false;if(g&&$(g).length){var d=g.data("id").split("_");if(typeof(d[1])!="undefined"){a=parseInt(d[1]);f=parseInt(d[2]);if(typeof(d[3])!="undefined"){c=parseInt(d[3])}if(typeof(d[4])!="undefined"){b=parseInt(d[4])}}}if(!a){var h=$(this).parent().parent().data("id").replace("cart_block_product_","");h=h.replace("deleteCustomizableProduct_","");d=h.split("_");f=parseInt(d[0]);if(typeof(d[1])!="undefined"){c=parseInt(d[1])}if(typeof(d[2])!="undefined"){b=parseInt(d[2])}}ajaxCart.remove(f,c,a,b)})},expand:function(){if($(".cart_block_list").hasClass("collapsed")){$(".cart_block_list.collapsed").slideDown({duration:450,complete:function(){$(this).addClass("expanded").removeClass("collapsed")}});$.ajax({type:"POST",headers:{"cache-control":"no-cache"},url:baseDir+"modules/blockcart/blockcart-set-collapse.php?rand="+new Date().getTime(),async:true,cache:false,data:"ajax_blockcart_display=expand",complete:function(){$(".block_cart_expand").fadeOut("fast",function(){$(".block_cart_collapse").fadeIn("fast")})}})}},collapse:function(){if($(".cart_block_list").hasClass("expanded")){$(".cart_block_list.expanded").slideUp("slow",function(){$(this).addClass("collapsed").removeClass("expanded")});$.ajax({type:"POST",headers:{"cache-control":"no-cache"},url:baseDir+"modules/blockcart/blockcart-set-collapse.php?rand="+new Date().getTime(),async:true,cache:false,data:"ajax_blockcart_display=collapse&rand="+new Date().getTime(),complete:function(){$(".block_cart_collapse").fadeOut("fast",function(){$(".block_cart_expand").fadeIn("fast")})}})}},refresh:function(){$.ajax({type:"POST",headers:{"cache-control":"no-cache"},url:baseUri+"?rand="+new Date().getTime(),async:true,cache:false,dataType:"json",data:"controller=cart&ajax=true&token="+static_token,success:function(a){ajaxCart.updateCart(a)}})},updateCartInformation:function(a,b){ajaxCart.updateCart(a);if(b){$("#add_to_cart button").removeProp("disabled").removeClass("disabled");if(!a.hasError||a.hasError==false){$("#add_to_cart button").addClass("added")}else{$("#add_to_cart button").removeClass("added")}}else{$(".ajax_add_to_cart_button").removeProp("disabled")}},updateFancyBox:function(){},add:function(d,c,h,b,g,a){if(h&&!checkCustomizations()){if(contentOnly){var j=window.document.location.href+"";var f=j.replace("content_only=1","");window.parent.document.location.href=f;return}if(!!$.prototype.fancybox){$.fancybox.open([{type:"inline",autoScale:true,minHeight:30,content:'<p class="fancybox-error">'+fieldRequired+"</p>"}],{padding:0})}else{alert(fieldRequired)}return}emptyCustomizations();if(h){$("#add_to_cart button").prop("disabled","disabled").addClass("disabled");$(".filled").removeClass("filled")}else{$(b).prop("disabled","disabled")}if($(".cart_block_list").hasClass("collapsed")){this.expand()}$.ajax({type:"POST",headers:{"cache-control":"no-cache"},url:baseUri+"?rand="+new Date().getTime(),async:true,cache:false,dataType:"json",data:"controller=cart&add=1&ajax=true&qty="+((g&&g!=null)?g:"1")+"&id_product="+d+"&token="+static_token+((parseInt(c)&&c!=null)?"&ipa="+parseInt(c):""),success:function(k,m,l){if(a&&!k.errors){WishlistAddProductCart(a[0],d,c,a[1])}if(!k.hasError){if(contentOnly){window.parent.ajaxCart.updateCartInformation(k,h)}else{ajaxCart.updateCartInformation(k,h)}if(k.crossSelling){$(".crossseling").html(k.crossSelling)}if(c){$(k.products).each(function(){if(this.id!=undefined&&this.id==parseInt(d)&&this.idCombination==parseInt(c)){if(contentOnly){window.parent.ajaxCart.updateLayer(this)}else{ajaxCart.updateLayer(this)}}})}else{$(k.products).each(function(){if(this.id!=undefined&&this.id==parseInt(d)){if(contentOnly){window.parent.ajaxCart.updateLayer(this)}else{ajaxCart.updateLayer(this)}}})}if(contentOnly){parent.$.fancybox.close()}}else{if(contentOnly){window.parent.ajaxCart.updateCart(k)}else{ajaxCart.updateCart(k)}if(h){$("#add_to_cart button").removeProp("disabled").removeClass("disabled")}else{$(b).removeProp("disabled")}}},error:function(l,n,m){var k="Impossible to add the product to the cart.<br/>textStatus: '"+n+"'<br/>errorThrown: '"+m+"'<br/>responseText:<br/>"+l.responseText;if(!!$.prototype.fancybox){$.fancybox.open([{type:"inline",autoScale:true,minHeight:30,content:'<p class="fancybox-error">'+k+"</p>"}],{padding:0})}else{alert(k)}if(h){$("#add_to_cart button").removeProp("disabled").removeClass("disabled")}else{$(b).removeProp("disabled")}}})},remove:function(d,c,a,b){$.ajax({type:"POST",headers:{"cache-control":"no-cache"},url:baseUri+"?rand="+new Date().getTime(),async:true,cache:false,dataType:"json",data:"controller=cart&delete=1&id_product="+d+"&ipa="+((c!=null&&parseInt(c))?c:"")+((a&&a!=null)?"&id_customization="+a:"")+"&id_address_delivery="+b+"&token="+static_token+"&ajax=true",success:function(f){ajaxCart.updateCart(f);if($("body").attr("id")=="order"||$("body").attr("id")=="order-opc"){deleteProductFromSummary(d+"_"+c+"_"+a+"_"+b)}},error:function(){var f="ERROR: unable to delete the product";if(!!$.prototype.fancybox){$.fancybox.open([{type:"inline",autoScale:true,minHeight:30,content:f}],{padding:0})}else{alert(f)}}})},hideOldProducts:function(c){if($(".cart_block_list:first dl.products").length>0){var b=null;var d=null;var a=null;$(".cart_block_list:first dl.products dt").each(function(){var j=$(this).data("id");var h=j.replace("cart_block_product_","");var f=h.split("_");var g=false;for(aProduct in c.products){if(c.products[aProduct]["id"]==f[0]&&(!f[1]||c.products[aProduct]["idCombination"]==f[1])){g=true;ajaxCart.hideOldProductCustomizations(c.products[aProduct],j)}}if(!g){b=$(this).data("id");if(b!=null){var h=b.replace("cart_block_product_","");var f=h.split("_");$('dt[data-id="'+b+'"]').addClass("strike").fadeTo("slow",0,function(){$(this).slideUp("slow",function(){$(this).remove();if($(".cart_block:first dl.products dt").length==0){$("#header .cart_block").stop(true,true).slideUp(200);$(".cart_block_no_products:hidden").slideDown(450);$(".cart_block dl.products").remove()}})});$('dd[data-id="cart_block_combination_of_'+f[0]+(f[1]?"_"+f[1]:"")+(f[2]?"_"+f[2]:"")+'"]').fadeTo("fast",0,function(){$(this).slideUp("fast",function(){$(this).remove()})})}}})}},hideOldProductCustomizations:function(d,c){var a=$('ul[data-id="customization_'+d.id+"_"+d.idCombination+'"]');if(a.length>0){$(a).find("li").each(function(){$(this).find("div").each(function(){var g=$(this).data("id");var f=g.replace("deleteCustomizableProduct_","");var h=f.split("_");if((parseInt(d.idCombination)==parseInt(h[2]))&&!ajaxCart.doesCustomizationStillExist(d,h[0])){$('div[data-id="'+g+'"]').parent().addClass("strike").fadeTo("slow",0,function(){$(this).slideUp("slow");$(this).remove()})}})})}var b=$('.deleteCustomizableProduct[data-id="'+c+'"]').find(".ajax_cart_block_remove_link");if(!d.hasCustomizedDatas&&!b.length){$('div[data-id="'+c+'"] span.remove_link').html('<a class="ajax_cart_block_remove_link" rel="nofollow" href="'+baseUri+"?controller=cart&amp;delete=1&amp;id_product="+d.id+"&amp;ipa="+d.idCombination+"&amp;token="+static_token+'"> </a>')}if(d.is_gift){$('div[data-id="'+c+'"] span.remove_link').html("")}},doesCustomizationStillExist:function(c,a){var b=false;$(c.customizedDatas).each(function(){if(this.customizationId==a){b=true;return false}});return(b)},refreshVouchers:function(a){if(typeof(a.discounts)=="undefined"||a.discounts.length==0){$(".vouchers").hide()}else{$(".vouchers tbody").html("");for(i=0;i<a.discounts.length;i++){if(parseFloat(a.discounts[i].price_float)>0){var b="";if(a.discounts[i].code.length){b='<a class="delete_voucher" href="'+a.discounts[i].link+'" title="'+delete_txt+'"><i class="icon-remove-sign"></i></a>'}$(".vouchers tbody").append($('<tr class="bloc_cart_voucher" data-id="bloc_cart_voucher_'+a.discounts[i].id+'">	<td class="quantity">1x</td>	<td class="name" title="'+a.discounts[i].description+'">'+a.discounts[i].name+'</td>	<td class="price">-'+a.discounts[i].price+'</td>	<td class="delete">'+b+"</td></tr>"))}}$(".vouchers").show()}},updateProductQuantity:function(a,b){$("dt[data-id=cart_block_product_"+a.id+"_"+(a.idCombination?a.idCombination:"0")+"_"+(a.idAddressDelivery?a.idAddressDelivery:"0")+"] .quantity").fadeTo("fast",0,function(){$(this).text(b);$(this).fadeTo("fast",1,function(){$(this).fadeTo("fast",0,function(){$(this).fadeTo("fast",1,function(){$(this).fadeTo("fast",0,function(){$(this).fadeTo("fast",1)})})})})})},displayNewProducts:function(a){$(a.products).each(function(){if(this.id!=undefined){if($(".cart_block:first dl.products").length==0){$(".cart_block_no_products").before('<dl class="products"></dl>');$(".cart_block_no_products").hide()}var j=this.id+"_"+(this.idCombination?this.idCombination:"0")+"_"+(this.idAddressDelivery?this.idAddressDelivery:"0");var k=this.id+"_"+(this.idCombination?this.idCombination:"0");if($('dt[data-id="cart_block_product_'+j+'"]').length==0){var g=parseInt(this.id);var c=(this.hasAttributes?parseInt(this.attributes):0);var h='<dt class="unvisible" data-id="cart_block_product_'+j+'">';var b=$.trim($("<span />").html(this.name).text());b=(b.length>12?b.substring(0,10)+"...":b);h+='<a class="cart-images" href="'+this.link+'" title="'+b+'"><img  src="'+this.image_cart+'" alt="'+this.name+'"></a>';h+='<div class="cart-info"><div class="product-name"><span class="quantity-formated"><span class="quantity">'+this.quantity+'</span>&nbsp;x&nbsp;</span><a href="'+this.link+'" title="'+this.name+'" class="cart_block_product_name">'+b+"</a></div>";if(this.hasAttributes){h+='<div class="product-atributes"><a href="'+this.link+'" title="'+this.name+'">'+this.attributes+"</a></div>"}if(typeof(freeProductTranslation)!="undefined"){h+='<span class="price">'+(parseFloat(this.price_float)>0?this.priceByLine:freeProductTranslation)+"</span></div>"}if(typeof(this.is_gift)=="undefined"||this.is_gift==0){h+='<span class="remove_link"><a rel="nofollow" class="ajax_cart_block_remove_link" href="'+baseUri+"?controller=cart&amp;delete=1&amp;id_product="+g+"&amp;token="+static_token+(this.hasAttributes?"&amp;ipa="+parseInt(this.idCombination):"")+'"> </a></span>'}else{h+='<span class="remove_link"></span>'}h+="</dt>";if(this.hasAttributes){h+='<dd data-id="cart_block_combination_of_'+j+'" class="unvisible">'}if(this.hasCustomizedDatas){h+=ajaxCart.displayNewCustomizedDatas(this)}if(this.hasAttributes){h+="</dd>"}$(".cart_block dl.products").append(h)}else{var f=this;if($.trim($('dt[data-id="cart_block_product_'+j+'"] .quantity').html())!=f.quantity||$.trim($('dt[data-id="cart_block_product_'+j+'"] .price').html())!=f.priceByLine){if(!this.is_gift){$('dt[data-id="cart_block_product_'+j+'"] .price').text(f.priceByLine)}else{$('dt[data-id="cart_block_product_'+j+'"] .price').html(freeProductTranslation)}ajaxCart.updateProductQuantity(f,f.quantity);if(f.hasCustomizedDatas){customizationFormatedDatas=ajaxCart.displayNewCustomizedDatas(f);if(!$('ul[data-id="customization_'+k+'"]').length){if(f.hasAttributes){$('dd[data-id="cart_block_combination_of_'+j+'"]').append(customizationFormatedDatas)}else{$(".cart_block dl.products").append(customizationFormatedDatas)}}else{$('ul[data-id="customization_'+k+'"]').html("");$('ul[data-id="customization_'+k+'"]').append(customizationFormatedDatas)}}}}$(".cart_block dl.products .unvisible").slideDown(450).removeClass("unvisible");var d=$('dt[data-id="cart_block_product_'+j+'"]').find("a.ajax_cart_block_remove_link");if(this.hasCustomizedDatas&&d.length){$(d).each(function(){$(this).remove()})}}})},displayNewCustomizedDatas:function(f){var d="";var c=parseInt(f.id);var b=typeof(f.idCombination)=="undefined"?0:parseInt(f.idCombination);var a=$('ul[data-id="customization_'+c+"_"+b+'"]').length;if(!a){if(!f.hasAttributes){d+='<dd data-id="cart_block_combination_of_'+c+'" class="unvisible">'}if($('ul[data-id="customization_'+c+"_"+b+'"]').val()==undefined){d+='<ul class="cart_block_customizations" data-id="customization_'+c+"_"+b+'">'}}$(f.customizedDatas).each(function(){var g=0;customizationId=parseInt(this.customizationId);b=typeof(f.idCombination)=="undefined"?0:parseInt(f.idCombination);d+='<li name="customization"><div class="deleteCustomizableProduct" data-id="deleteCustomizableProduct_'+customizationId+"_"+c+"_"+(b?b:"0")+'"><a rel="nofollow" class="ajax_cart_block_remove_link" href="'+baseUri+"?controller=cart&amp;delete=1&amp;id_product="+c+"&amp;ipa="+b+"&amp;id_customization="+customizationId+"&amp;token="+static_token+'"></a></div>';$(this.datas).each(function(){if(this["type"]==CUSTOMIZE_TEXTFIELD){$(this.datas).each(function(){if(this["index"]==0){d+=" "+this.truncatedValue.replace(/<br \/>/g," ");g=1;return false}})}});if(!g){d+=customizationIdMessage+customizationId}if(!a){d+="</li>"}if(customizationId){$("#uploadable_files li div.customizationUploadBrowse img").remove();$("#text_fields input").attr("value","")}});if(!a){d+="</ul>";if(!f.hasAttributes){d+="</dd>"}}return(d)},updateLayer:function(a){$("#layer_cart_product_title").text(a.name);$("#layer_cart_product_attributes").text("");if(a.hasAttributes&&a.hasAttributes==true){$("#layer_cart_product_attributes").html(a.attributes)}$("#layer_cart_product_price").text(a.price);$("#layer_cart_product_quantity").text(a.quantity);$(".layer_cart_img").html('<img class="layer_cart_img img-responsive" src="'+a.image+'" alt="'+a.name+'" title="'+a.name+'" />');var b=parseInt($(window).scrollTop())+"px";$(".layer_cart_overlay").css("width","100%");$(".layer_cart_overlay").css("height","100%");$(".layer_cart_overlay").show();$("#layer_cart").css({top:b}).fadeIn("fast");crossselling_serialScroll()},updateCart:function(a){if(a.hasError){var b="";for(error in a.errors){if(error!="indexOf"){b+=$("<div />").html(a.errors[error]).text()+"\n"}}if(!!$.prototype.fancybox){$.fancybox.open([{type:"inline",autoScale:true,minHeight:30,content:'<p class="fancybox-error">'+b+"</p>"}],{padding:0})}else{alert(b)}}else{ajaxCart.updateCartEverywhere(a);ajaxCart.hideOldProducts(a);ajaxCart.displayNewProducts(a);ajaxCart.refreshVouchers(a);$(".cart_block .products dt").removeClass("first_item").removeClass("last_item").removeClass("item");$(".cart_block .products dt:first").addClass("first_item");$(".cart_block .products dt:not(:first,:last)").addClass("item");$(".cart_block .products dt:last").addClass("last_item")}},updateCartEverywhere:function(a){$(".ajax_cart_total").text($.trim(a.productTotal));if(parseFloat(a.shippingCostFloat)>0){$(".ajax_cart_shipping_cost").text(a.shippingCost)}else{if(typeof(freeShippingTranslation)!="undefined"){$(".ajax_cart_shipping_cost").html(freeShippingTranslation)}}$(".ajax_cart_tax_cost").text(a.taxCost);$(".cart_block_wrapping_cost").text(a.wrappingCost);$(".ajax_block_cart_total").text(a.total);$(".ajax_block_products_total").text(a.productTotal);$(".ajax_total_price_wt").text(a.total_price_wt);if(parseFloat(a.freeShippingFloat)>0){$(".ajax_cart_free_shipping").html(a.freeShipping);$(".freeshipping").fadeIn(0)}else{if(parseFloat(a.freeShippingFloat)==0){$(".freeshipping").fadeOut(0)}}this.nb_total_products=a.nbTotalProducts;if(parseInt(a.nbTotalProducts)>0){$(".ajax_cart_no_product").hide();$(".ajax_cart_quantity").text(a.nbTotalProducts);$(".ajax_cart_quantity").fadeIn("slow");$(".ajax_cart_total").fadeIn("slow");if(parseInt(a.nbTotalProducts)>1){$(".ajax_cart_product_txt").each(function(){$(this).hide()});$(".ajax_cart_product_txt_s").each(function(){$(this).show()})}else{$(".ajax_cart_product_txt").each(function(){$(this).show()});$(".ajax_cart_product_txt_s").each(function(){$(this).hide()})}}else{$(".ajax_cart_quantity, .ajax_cart_product_txt_s, .ajax_cart_product_txt, .ajax_cart_total").each(function(){$(this).hide()});$(".ajax_cart_no_product").show("slow")}}};function HoverWatcher(a){this.hovering=false;var b=this;this.isHoveringOver=function(){return b.hovering};$(a).hover(function(){b.hovering=true},function(){b.hovering=false})}function crossselling_serialScroll(){if(!!$.prototype.bxSlider){$("#blockcart_caroucel").bxSlider({minSlides:2,maxSlides:4,slideWidth:178,slideMargin:20,moveSlides:1,infiniteLoop:false,hideControlOnEnd:true,pager:false})}};